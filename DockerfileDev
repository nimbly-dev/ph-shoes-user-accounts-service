FROM maven:3-amazoncorretto-21 AS dev
WORKDIR /app

RUN mkdir -p /root/.m2 && printf '%s\n' \
  '<settings>' \
  '  <servers>' \
  '    <server>' \
  '      <id>github</id>' \
  '      <username>${env.GH_ACTOR}</username>' \
  '      <password>${env.GH_PACKAGES_TOKEN}</password>' \
  '    </server>' \
  '  </servers>' \
  '</settings>' \
  > /root/.m2/settings.xml

COPY pom.xml .
COPY src ./src

EXPOSE 8080
CMD ["mvn","-U","-Pdev","spring-boot:run","-Dspring-boot.run.profiles=dev","-Dspring-boot.run.fork=false","-Dspring-boot.run.jvmArguments=${JAVA_TOOL_OPTIONS}"]
