FROM maven:3-amazoncorretto-21 AS dev
WORKDIR /app

RUN mkdir -p /root/.m2 && printf '%s\n' \
  '<settings>' \
  '  <servers>' \
  '    <server>' \
  '      <id>github</id>' \
  '      <username>${env.GH_ACTOR}</username>' \
  '      <password>${env.GH_PACKAGES_TOKEN}</password>' \
  '    </server>' \
  '  </servers>' \
  '</settings>' \
  > /root/.m2/settings.xml

COPY pom.xml .
COPY ph-shoes-user-accounts-service-core/pom.xml ph-shoes-user-accounts-service-core/pom.xml
COPY ph-shoes-user-accounts-service-web/pom.xml ph-shoes-user-accounts-service-web/pom.xml
COPY ph-shoes-user-accounts-service-core ./ph-shoes-user-accounts-service-core
COPY ph-shoes-user-accounts-service-web ./ph-shoes-user-accounts-service-web

EXPOSE 8080
CMD ["mvn","-pl","ph-shoes-user-accounts-service-web","-am","-U","-Pdev","spring-boot:run","-Dspring-boot.run.profiles=dev","-Dspring-boot.run.fork=false","-Dspring-boot.run.jvmArguments=${JAVA_TOOL_OPTIONS}"]
