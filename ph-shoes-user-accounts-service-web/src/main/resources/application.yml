app:
  cors:
    allowed-origins: http://localhost:5173,http://127.0.0.1:5173,https://www.phshoesproject.com,https://phshoesproject.com
    allowed-methods: GET,POST,PUT,PATCH,DELETE,OPTIONS
    allowed-headers: Authorization,Content-Type,X-Unsubscribe-Token,List-Unsubscribe-Post
    exposed-headers: Authorization,Content-Type,X-Unsubscribe-Token,List-Unsubscribe-Post
    allow-credentials: true
    max-age: 3600
  frontend:
    base-url: ${APP_FRONTEND_BASE_URL:http://localhost:5173}
    verify-path: ${APP_FRONTEND_VERIFY_PATH:/}
    unsubscribe-path: ${APP_FRONTEND_UNSUBSCRIBE_PATH:/}

spring:
  application:
    name: ph-shoes-user-account-service
  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      adjust-dates-to-context-time-zone: false
  mvc:
    problemdetails:
      enabled: false
  devtools:
    restart:
      enabled: ${SPRING_DEVTOOLS_RESTART_ENABLED:false}
      additional-paths: ${SPRING_DEVTOOLS_RESTART_ADDITIONAL_PATHS:}

aws:
  region: ${AWS_REGION:ap-southeast-1}
  endpoint: ${AWS_ENDPOINT:}

notification:
  provider: ${NOTIFICATION_PROVIDER:ses}
  transport: ${NOTIFICATION_TRANSPORT:sesv2}
  email:
    from: ${NOTIFICATION_EMAIL_FROM:PH Shoes <no-reply@local.test>}
    subjectPrefix: ${NOTIFICATION_SUBJECT_PREFIX:[PH-Shoes]}
    listUnsubscribe: "${NOTIFICATION_LIST_UNSUBSCRIBE:<mailto:unsubscribe@local.test>}"
    listUnsubscribePost: "${NOTIFICATION_LIST_UNSUBSCRIBE_POST:List-Unsubscribe=One-Click}"
    unsubscribeLink: ${NOTIFICATION_UNSUBSCRIBE_LINK:http://localhost:8082/api/v1/user-accounts/unsubscribe}
  smtp:
    host: ${NOTIFICATION_SMTP_HOST:mailhog}
    port: ${NOTIFICATION_SMTP_PORT:1025}
    auth: ${NOTIFICATION_SMTP_AUTH:false}
    starttls: ${NOTIFICATION_SMTP_STARTTLS:false}
    connectionTimeoutMillis: ${NOTIFICATION_SMTP_CONNECTION_TIMEOUT_MILLIS:2000}
    readTimeoutMillis: ${NOTIFICATION_SMTP_READ_TIMEOUT_MILLIS:2000}
    writeTimeoutMillis: ${NOTIFICATION_SMTP_WRITE_TIMEOUT_MILLIS:2000}
  ses:
    region: ${AWS_REGION:ap-southeast-1}
    endpoint: ${AWS_ENDPOINT:}
    configurationSet: ${SES_CONFIGURATION_SET:}
    webhook:
      enabled: ${SES_WEBHOOK_ENABLED:true}
      verify-signature: ${SES_WEBHOOK_VERIFY_SIGNATURE:true}
      auto-confirm-subscriptions: ${SES_WEBHOOK_AUTO_CONFIRM:true}
      allowed-topics: ${SES_WEBHOOK_ALLOWED_TOPICS:*}

verification:
  ttlSeconds: ${VERIFICATION_TTL_SECONDS:900}
  secret: ${VERIFICATION_SECRET:dev-secret-change-me}
  verificationLink: ${VERIFICATION_LINK:http://localhost:8082/api/v1/verify/email}
  notMeLink: ${VERIFICATION_NOT_ME_URL:http://localhost:8082/api/v1/verify/email/not-me}
  unsubscribeLink: ${NOTIFICATION_UNSUBSCRIBE_LINK:http://localhost:8082/api/v1/user-accounts/unsubscribe}

server:
  port: ${PORT:8082}
  servlet:
    context-path: /api/v1
  error:
    include-stacktrace: ${SERVER_ERROR_INCLUDE_STACKTRACE:never}
    include-message: ${SERVER_ERROR_INCLUDE_MESSAGE:never}

management:
  endpoints:
    web:
      exposure:
        include: health,info

logging:
  pattern:
    console: ${LOGGING_PATTERN_CONSOLE:%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level traceId=%X{traceId} %logger{36} - %msg%n}
  level:
    root: ${LOGGING_LEVEL_ROOT:INFO}

auth:
  lock:
    maxFailures: ${AUTH_LOCK_MAX_FAILURES:5}
    durationSeconds: ${AUTH_LOCK_DURATION_SECONDS:900}

springdoc:
  api-docs:
    enabled: ${SPRINGDOC_APIDOCS_ENABLED:false}
  swagger-ui:
    enabled: ${SPRINGDOC_SWAGGER_UI_ENABLED:false}
    persistAuthorization: ${SPRINGDOC_PERSIST_AUTHORIZATION:true}

phshoes:
  dynamo:
    migrations:
      enabled: ${DYNAMO_MIGRATIONS_ENABLED:true}
  security:
    email:
      enabled: ${PHSHOES_SECURITY_EMAIL_ENABLED:true}
      hmac-pepper-b64: ${HMAC_PEPPER_B64}
      aes-key-b64: ${AES_KEY_B64}
      legacy-peppers-b64: ${HMAC_LEGACY_PEPPERS_B64:}
    auth:
      dummy-bcrypt-hash: ${DUMMY_BCRYPT_HASH:$2a$10$u5m1eR4h1Vn0l2G0pC7l3u7b9vXl9lN8mTt4l7t0rQkN1G0u8Hh6C}
    jwt:
      enabled: ${JWT_ENABLED:true}
      issuer: ${JWT_ISSUER:ph-shoes}
      secret: ${JWT_SECRET:change-me-for-dev}
      access-ttl-seconds: ${JWT_ACCESS_TTL_SECONDS:3600}
      skip-paths:
        - /system/status
  suppression:
    table-name: ${SUPPRESSION_TABLE_NAME:email_suppressions}
  status:
    enabled: ${STATUS_ENABLED:true}
    path: /system/status
    service-id: user-accounts
    display-name: User Accounts
    environment: ${APP_ENV:local}
    version: ${APP_VERSION:local}
    description: Handles registration, verification, and suppression workflows.
    metadata:
      tier: backend
  api:
    rate-limit:
      enabled: ${API_RATE_LIMIT_ENABLED:true}
      default-window: ${API_RATE_LIMIT_DEFAULT_WINDOW:24h}
      global:
        enabled: ${API_RATE_LIMIT_GLOBAL_ENABLED:true}
        limit: ${API_RATE_LIMIT_GLOBAL_LIMIT:2000}
      per-ip:
        enabled: ${API_RATE_LIMIT_PER_IP_ENABLED:true}
        limit: ${API_RATE_LIMIT_PER_IP_LIMIT:120}
      per-user:
        enabled: ${API_RATE_LIMIT_PER_USER_ENABLED:true}
        limit: ${API_RATE_LIMIT_PER_USER_LIMIT:60}
        window: ${API_RATE_LIMIT_PER_USER_WINDOW:1h}
      routes:
        - name: signup-create
          pattern: /api/v1/user-accounts
          methods: [POST]
          per-user:
            enabled: true
            limit: 3
            window: 1h
        - name: verification-resend
          pattern: /api/v1/verify/email/resend
          methods: [POST]
          per-user:
            enabled: true
            limit: 3
            window: 1h
        - name: status-health
          pattern: /api/v1/system/status
          methods: [GET]
          global:
            enabled: false
          per-ip:
            enabled: false
          per-user:
            enabled: false
